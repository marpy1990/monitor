<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sjtu.cit.monitor.dal.dao.SourceTreeStateDao">
	<select id="isOpen" parameterType="sjtu.cit.monitor.dal.entity.SourceNode" resultType="boolean"><![CDATA[
		select
			ISOPEN
		from 
			SOURCE_NODE_STATE
		where
			SOURCEID=#{sourceId}
		and SPACEID=#{spaceId}
		and	USERID=#{userId}
		and TREEID=#{treeId}
	]]></select>
	
	<insert id="insertNode" parameterType="sjtu.cit.monitor.dal.entity.SourceNode"><![CDATA[
		insert into SOURCE_NODE_STATE (
			SOURCEID,
			SPACEID,
			TREEID,
			USERID,
			ISOPEN
		) values(
			#{sourceId},
			#{spaceId},
			#{treeId},
			#{userId},
			#{isOpen}
		)
	]]></insert>
	
	<update id="updateNode" parameterType="sjtu.cit.monitor.dal.entity.SourceNode"><![CDATA[
        update
        	SOURCE_NODE_STATE
        set
        	ISOPEN=#{isOpen}
        where
        	SOURCEID=#{sourceId}
        and SPACEID=#{spaceId}
        and TREEID=#{treeId}
        and USERID=#{userId}
    ]]></update>
    
    <select id="getCurrentSpaceId" parameterType="sjtu.cit.monitor.dal.entity.TreeNode" resultType="int"><![CDATA[
		select
			CURRENT_SPACEID
		from 
			SOURCE_TREE_STATE
		where
	        USERID=#{userId}
		and TREEID=#{treeId}
	]]></select>
	
	<update id="updateSpace" parameterType="sjtu.cit.monitor.dal.entity.TreeNode"><![CDATA[
		update 
			SOURCE_TREE_STATE 
		set 
			CURRENT_SPACEID=#{currentSpaceId} 
		where 
			TREEID=#{treeId} 
		and USERID=#{userId}
	]]></update>
	
	<insert id="insertSpace" parameterType="sjtu.cit.monitor.dal.entity.TreeNode"><![CDATA[
		insert into SOURCE_TREE_STATE (
			CURRENT_SPACEID,
			TREEID,
			USERID
		) values(
			#{currentSpaceId},
			#{treeId},
			#{userId}
		)
	]]></insert>
    
</mapper>
